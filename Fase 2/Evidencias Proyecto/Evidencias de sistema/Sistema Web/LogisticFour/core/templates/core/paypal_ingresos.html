{% extends "core/base.html" %}
{% block title %}Ingresos PayPal{% endblock %}

{% block content %}
<h1 class="mb-3">Ingresos automáticos por PayPal</h1>
<p class="text-muted">Listado de órdenes creadas automáticamente tras pagos aprobados.</p>

<table class="table table-striped table-sm align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Orden</th>
      <th>Bodega</th>
      <th>Producto(s)</th>
      <th>Monto (USD)</th>
      <th>Fecha</th>
    </tr>
  </thead>
  <tbody>
  {% for oc in ordenes %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ oc.numero_orden }}</td>
      <td>{{ oc.bodega.nombre }}</td>
      <td>
        {% for linea in oc.lineas.all %}
          {{ linea.producto.nombre }} × {{ linea.cantidad_pedida }}
          {% if not forloop.last %}, {% endif %}
        {% endfor %}
      </td>
      <td>
        {% with f=oc.facturaproveedor_set.first %}
          {% if f %}{{ f.monto_total }}{% else %}—{% endif %}
        {% endwith %}
      </td>
      <td>{{ oc.creado_en|date:"d/m/Y H:i" }}</td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="6" class="text-center text-muted py-4">Sin registros de PayPal aún.</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
